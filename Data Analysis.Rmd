---
title: "Data Analysis"
author: "Catherine Cornella"
output: html_document
---

# Setup libraries
```{r Setup, message=FALSE, warning=FALSE}
library(dplyr)      #General Data wrangling
library(ggplot2)    #Plotting and analysis
library(readr)      #File reading and writing
library(stringr)    #String reading
library(knitr)      #Markdown file exporting
library(tidyr)      #Data formatting
library(lubridate)  #Date-Time Wrangling

#Establish General Import path: 
#If the data location is ever changed, it can be altered in this one location and hold true for every file. 
importPath="/data/airflow/analysis/"
```

# Import data

### Meteorological data

```{r Import:Meteor, message=FALSE, warning=FALSE}
path=paste(importPath, "MeteorDataDT.csv", sep="")
MeteorDataDT <- read_csv(path)
```

### Sensor Data

```{r Import:Sensor, message=FALSE, warning=FALSE}
path=paste(importPath, "cyclone-hx9-telescope_spider_south.csv", sep="")
cyc_df <- read_csv(path, skip=5)
path=paste(importPath, "darkthunder-dome_slit_bottom_horizontal.csv", sep="")
dark_df <- read_csv(path, skip=5)
path=paste(importPath, "freflow-mez_obsroom_horizontal.csv", sep="")
fre_df <- read_csv(path, skip=5)
path=paste(importPath, "picasso-mez_obsroom_vertical.csv", sep="")
pic_df <- read_csv(path, skip=5)
path=paste(importPath, "turbopanda-dome_slit_top_vertical.csv", sep="")
turbo_df <- read_csv(path, skip=5)
```

### Engineering Data

```{r Import:Engineering, message=FALSE, warning=FALSE}
# -- adamcomproom table -- 
#contains time, rack1, rack2, rack3
path=paste(importPath, "acrOutput.csv", sep="")
acr_df <- read_csv(path)

# -- adamtube table -- 
#contains time, mirroreast, mirrorwest, uppertubesouth, tubesnifseast
path=paste(importPath, "atOutput.csv", sep="")
at_df <- read_csv(path)

# -- boltwood table -- 
# contains time, temp, windspeed, skytempdiff
path=paste(importPath, "bwOutput.csv", sep="")
bw_df <- read_csv(path)

# -- cfht table -- 
# contains time, temp, windspeed, skytempdiff
path=paste(importPath, "cfhtOutput.csv", sep="")
cfht_df <- read_csv(path)

# -- tcs table -- 
# contains time, temp, windspeed, skytempdiff
path=paste(importPath, "tcsOutput.csv", sep="")
tcs_df <- read_csv(path)

# -- ups0 table -- 
# contains time, temp, windspeed, skytempdiff
path=paste(importPath, "upsOutput.csv", sep="")
ups_df <- read_csv(path)
```

# Tidy/Re-format Data

```{r}
#Meteorlogical data: 
#Narrow the dates down to our timeframe. 
weather_d <- MeteorDataDT %>% filter(MeteorDataDT$DateTime >= as.Date("2022-08-18") & MeteorDataDT$DateTime <= as.Date("2023-04-16") )

#Add all the Sensors into one dataframe.
sensorMaster <- rbind(cyc_df, dark_df, fre_df, pic_df, turbo_df)
```

# Analysis

Exploratory graph

```{r}
#graph of highest cn2 values - box and whisker
sensorMaster %>% #filter(sensor=="turbopanda")''' %>% 
ggplot( aes(x=(Cn2*100000000000), color=sensor)) + 
  geom_histogram(binwidth=0.00005) + xlim(0,0.05) 

#graph of highest cn2 values - box and whisker
sensorMaster %>% #filter(sensor=="turbopanda")''' %>% 
ggplot( aes(x=(Cn2*100000000000), color=sensor)) + 
  geom_histogram(binwidth=0.00005) + xlim(0,0.005) 

```

```{r }

scrap <- sensorMaster %>% mutate(daDate=date(dateTime)) %>% 
                        group_by(sensor, daDate)%>% 
                        mutate(Cn2=mean(Cn2)) 

ggplot(scrap, aes(x=(Cn2*100000000000), color=sensor)) + 
  geom_histogram(binwidth=0.00005) + xlim(0,0.005)

```

What's the sensor with the most optical turbulence? on average? 

When do we see the most optical turbulence? 

When we compare the mirror temp to the optical turbulence what do we see?

Comparison between wind direction while dome slit open and optical turbulence?
